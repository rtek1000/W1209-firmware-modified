                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ANSI-C Compiler
                                      3 ; Version 4.0.0 #11528 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module ts
                                      6 	.optsdcc -mstm8
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _main
                                     12 	.globl _getUptimeSeconds
                                     13 	.globl _getUptime
                                     14 	.globl _initTimer
                                     15 	.globl _initRelay
                                     16 	.globl _itofpa
                                     17 	.globl _paramToString
                                     18 	.globl _getParamById
                                     19 	.globl _getParamId
                                     20 	.globl _initParamsEEPROM
                                     21 	.globl _getMenuDisplay
                                     22 	.globl _initMenu
                                     23 	.globl _setDisplayTestMode
                                     24 	.globl _setDisplayStr
                                     25 	.globl _setDisplayOff
                                     26 	.globl _initDisplay
                                     27 	.globl _initButtons
                                     28 	.globl _getTemperature
                                     29 	.globl _initADC
                                     30 ;--------------------------------------------------------
                                     31 ; ram data
                                     32 ;--------------------------------------------------------
                                     33 	.area DATA
      000000                         34 _main_stringBuffer_65536_13:
      000000                         35 	.ds 14
                                     36 ;--------------------------------------------------------
                                     37 ; ram data
                                     38 ;--------------------------------------------------------
                                     39 	.area INITIALIZED
                                     40 ;--------------------------------------------------------
                                     41 ; Stack segment in internal ram 
                                     42 ;--------------------------------------------------------
                                     43 	.area	SSEG
      000000                         44 __start__stack:
      000000                         45 	.ds	1
                                     46 
                                     47 ;--------------------------------------------------------
                                     48 ; absolute external ram data
                                     49 ;--------------------------------------------------------
                                     50 	.area DABS (ABS)
                                     51 
                                     52 ; default segment ordering for linker
                                     53 	.area HOME
                                     54 	.area GSINIT
                                     55 	.area GSFINAL
                                     56 	.area CONST
                                     57 	.area INITIALIZER
                                     58 	.area CODE
                                     59 
                                     60 ;--------------------------------------------------------
                                     61 ; interrupt vector 
                                     62 ;--------------------------------------------------------
                                     63 	.area HOME
      000000                         64 __interrupt_vect:
      000000 82v00u00u00             65 	int s_GSINIT ; reset
      000004 82 00 00 00             66 	int 0x000000 ; trap
      000008 82 00 00 00             67 	int 0x000000 ; int0
      00000C 82 00 00 00             68 	int 0x000000 ; int1
      000010 82 00 00 00             69 	int 0x000000 ; int2
      000014 82 00 00 00             70 	int 0x000000 ; int3
      000018 82 00 00 00             71 	int 0x000000 ; int4
      00001C 82v00u00u00             72 	int _EXTI2_handler ; int5
      000020 82 00 00 00             73 	int 0x000000 ; int6
      000024 82 00 00 00             74 	int 0x000000 ; int7
      000028 82 00 00 00             75 	int 0x000000 ; int8
      00002C 82 00 00 00             76 	int 0x000000 ; int9
      000030 82 00 00 00             77 	int 0x000000 ; int10
      000034 82 00 00 00             78 	int 0x000000 ; int11
      000038 82 00 00 00             79 	int 0x000000 ; int12
      00003C 82 00 00 00             80 	int 0x000000 ; int13
      000040 82 00 00 00             81 	int 0x000000 ; int14
      000044 82 00 00 00             82 	int 0x000000 ; int15
      000048 82 00 00 00             83 	int 0x000000 ; int16
      00004C 82 00 00 00             84 	int 0x000000 ; int17
      000050 82 00 00 00             85 	int 0x000000 ; int18
      000054 82 00 00 00             86 	int 0x000000 ; int19
      000058 82 00 00 00             87 	int 0x000000 ; int20
      00005C 82 00 00 00             88 	int 0x000000 ; int21
      000060 82v00u00u00             89 	int _ADC1_EOC_handler ; int22
      000064 82v00u00u00             90 	int _TIM4_UPD_handler ; int23
                                     91 ;--------------------------------------------------------
                                     92 ; global & static initialisations
                                     93 ;--------------------------------------------------------
                                     94 	.area HOME
                                     95 	.area GSINIT
                                     96 	.area GSFINAL
                                     97 	.area GSINIT
      000000                         98 __sdcc_gs_init_startup:
      000000                         99 __sdcc_init_data:
                                    100 ; stm8_genXINIT() start
      000000 AEr00r00         [ 2]  101 	ldw x, #l_DATA
      000003 27 07            [ 1]  102 	jreq	00002$
      000005                        103 00001$:
      000005 72 4FuFFuFF      [ 1]  104 	clr (s_DATA - 1, x)
      000009 5A               [ 2]  105 	decw x
      00000A 26 F9            [ 1]  106 	jrne	00001$
      00000C                        107 00002$:
      00000C AEr00r00         [ 2]  108 	ldw	x, #l_INITIALIZER
      00000F 27 09            [ 1]  109 	jreq	00004$
      000011                        110 00003$:
      000011 D6uFFuFF         [ 1]  111 	ld	a, (s_INITIALIZER - 1, x)
      000014 D7uFFuFF         [ 1]  112 	ld	(s_INITIALIZED - 1, x), a
      000017 5A               [ 2]  113 	decw	x
      000018 26 F7            [ 1]  114 	jrne	00003$
      00001A                        115 00004$:
                                    116 ; stm8_genXINIT() end
                                    117 	.area GSFINAL
      000000 CCr00r68         [ 2]  118 	jp	__sdcc_program_startup
                                    119 ;--------------------------------------------------------
                                    120 ; Home
                                    121 ;--------------------------------------------------------
                                    122 	.area HOME
                                    123 	.area HOME
      000068                        124 __sdcc_program_startup:
      000068 CCr00r00         [ 2]  125 	jp	_main
                                    126 ;	return from main will return to caller
                                    127 ;--------------------------------------------------------
                                    128 ; code
                                    129 ;--------------------------------------------------------
                                    130 	.area CODE
                                    131 ;	./ts.c: 33: int main()
                                    132 ;	-----------------------------------------
                                    133 ;	 function main
                                    134 ;	-----------------------------------------
      000000                        135 _main:
      000000 52 0B            [ 2]  136 	sub	sp, #11
                                    137 ;	./ts.c: 36: unsigned char paramMsg[] = {'P', '0', 0};
      000002 A6 50            [ 1]  138 	ld	a, #0x50
      000004 6B 03            [ 1]  139 	ld	(0x03, sp), a
      000006 96               [ 1]  140 	ldw	x, sp
      000007 1C 00 04         [ 2]  141 	addw	x, #4
      00000A 1F 06            [ 2]  142 	ldw	(0x06, sp), x
      00000C A6 30            [ 1]  143 	ld	a, #0x30
      00000E F7               [ 1]  144 	ld	(x), a
      00000F 96               [ 1]  145 	ldw	x, sp
      000010 1C 00 05         [ 2]  146 	addw	x, #5
      000013 7F               [ 1]  147 	clr	(x)
                                    148 ;	./ts.c: 38: initMenu();
      000014 CDr00r00         [ 4]  149 	call	_initMenu
                                    150 ;	./ts.c: 39: initButtons();
      000017 CDr00r00         [ 4]  151 	call	_initButtons
                                    152 ;	./ts.c: 40: initParamsEEPROM();
      00001A CDr00r00         [ 4]  153 	call	_initParamsEEPROM
                                    154 ;	./ts.c: 41: initDisplay();
      00001D CDr00r00         [ 4]  155 	call	_initDisplay
                                    156 ;	./ts.c: 42: initADC();
      000020 CDr00r00         [ 4]  157 	call	_initADC
                                    158 ;	./ts.c: 43: initRelay();
      000023 CDr00r00         [ 4]  159 	call	_initRelay
                                    160 ;	./ts.c: 44: initTimer();
      000026 CDr00r00         [ 4]  161 	call	_initTimer
                                    162 ;	./ts.c: 46: INTERRUPT_ENABLE
      000029 9A               [ 1]  163 	rim	
                                    164 ;	./ts.c: 49: while (true) {
      00002A                        165 00123$:
                                    166 ;	./ts.c: 50: if (getUptimeSeconds() > 0) {
      00002A CDr00r00         [ 4]  167 	call	_getUptimeSeconds
      00002D 4D               [ 1]  168 	tnz	a
      00002E 27 0B            [ 1]  169 	jreq	00102$
                                    170 ;	./ts.c: 51: setDisplayTestMode (false, "");
      000030 4Br00            [ 1]  171 	push	#<(___str_0 + 0)
      000032 4Bs00            [ 1]  172 	push	#((___str_0 + 0) >> 8)
      000034 4B 00            [ 1]  173 	push	#0x00
      000036 CDr00r00         [ 4]  174 	call	_setDisplayTestMode
      000039 5B 03            [ 2]  175 	addw	sp, #3
      00003B                        176 00102$:
                                    177 ;	./ts.c: 54: if (getMenuDisplay() == MENU_ROOT) {
      00003B CDr00r00         [ 4]  178 	call	_getMenuDisplay
      00003E 6B 0B            [ 1]  179 	ld	(0x0b, sp), a
      000040 26 5B            [ 1]  180 	jrne	00120$
                                    181 ;	./ts.c: 55: int temp = getTemperature();
      000042 CDr00r00         [ 4]  182 	call	_getTemperature
      000045 1F 08            [ 2]  183 	ldw	(0x08, sp), x
                                    184 ;	./ts.c: 56: itofpa (temp, (char*) stringBuffer, 0);
      000047 AEr00r00         [ 2]  185 	ldw	x, #(_main_stringBuffer_65536_13 + 0)
      00004A 4B 00            [ 1]  186 	push	#0x00
      00004C 89               [ 2]  187 	pushw	x
      00004D 1E 0B            [ 2]  188 	ldw	x, (0x0b, sp)
      00004F 89               [ 2]  189 	pushw	x
      000050 CDr00r00         [ 4]  190 	call	_itofpa
      000053 5B 05            [ 2]  191 	addw	sp, #5
                                    192 ;	./ts.c: 57: setDisplayStr ( (char*) stringBuffer);
      000055 AEr00r00         [ 2]  193 	ldw	x, #(_main_stringBuffer_65536_13 + 0)
      000058 89               [ 2]  194 	pushw	x
      000059 CDr00r00         [ 4]  195 	call	_setDisplayStr
      00005C 5B 02            [ 2]  196 	addw	sp, #2
                                    197 ;	./ts.c: 59: if (getParamById (PARAM_OVERHEAT_INDICATION) ) {
      00005E 4B 06            [ 1]  198 	push	#0x06
      000060 CDr00r00         [ 4]  199 	call	_getParamById
      000063 84               [ 1]  200 	pop	a
      000064 5D               [ 2]  201 	tnzw	x
      000065 26 03            [ 1]  202 	jrne	00174$
      000067 CCr01r1E         [ 2]  203 	jp	00121$
      00006A                        204 00174$:
                                    205 ;	./ts.c: 60: if (temp < getParamById (PARAM_MIN_TEMPERATURE) ) {
      00006A 4B 03            [ 1]  206 	push	#0x03
      00006C CDr00r00         [ 4]  207 	call	_getParamById
      00006F 84               [ 1]  208 	pop	a
      000070 1F 0A            [ 2]  209 	ldw	(0x0a, sp), x
      000072 1E 08            [ 2]  210 	ldw	x, (0x08, sp)
      000074 13 0A            [ 2]  211 	cpw	x, (0x0a, sp)
      000076 2E 0C            [ 1]  212 	jrsge	00106$
                                    213 ;	./ts.c: 61: setDisplayStr ("LLL");
      000078 4Br01            [ 1]  214 	push	#<(___str_1 + 0)
      00007A 4Bs00            [ 1]  215 	push	#((___str_1 + 0) >> 8)
      00007C CDr00r00         [ 4]  216 	call	_setDisplayStr
      00007F 5B 02            [ 2]  217 	addw	sp, #2
      000081 CCr01r1E         [ 2]  218 	jp	00121$
      000084                        219 00106$:
                                    220 ;	./ts.c: 62: } else if (temp > getParamById (PARAM_MAX_TEMPERATURE) ) {
      000084 4B 02            [ 1]  221 	push	#0x02
      000086 CDr00r00         [ 4]  222 	call	_getParamById
      000089 84               [ 1]  223 	pop	a
      00008A 13 08            [ 2]  224 	cpw	x, (0x08, sp)
      00008C 2F 03            [ 1]  225 	jrslt	00176$
      00008E CCr01r1E         [ 2]  226 	jp	00121$
      000091                        227 00176$:
                                    228 ;	./ts.c: 63: setDisplayStr ("HHH");
      000091 4Br05            [ 1]  229 	push	#<(___str_2 + 0)
      000093 4Bs00            [ 1]  230 	push	#((___str_2 + 0) >> 8)
      000095 CDr00r00         [ 4]  231 	call	_setDisplayStr
      000098 5B 02            [ 2]  232 	addw	sp, #2
      00009A CCr01r1E         [ 2]  233 	jp	00121$
      00009D                        234 00120$:
                                    235 ;	./ts.c: 66: } else if (getMenuDisplay() == MENU_SET_THRESHOLD) {
      00009D CDr00r00         [ 4]  236 	call	_getMenuDisplay
      0000A0 4A               [ 1]  237 	dec	a
      0000A1 26 16            [ 1]  238 	jrne	00117$
                                    239 ;	./ts.c: 67: paramToString (PARAM_THRESHOLD, (char*) stringBuffer);
      0000A3 AEr00r00         [ 2]  240 	ldw	x, #(_main_stringBuffer_65536_13 + 0)
      0000A6 89               [ 2]  241 	pushw	x
      0000A7 4B 09            [ 1]  242 	push	#0x09
      0000A9 CDr00r00         [ 4]  243 	call	_paramToString
      0000AC 5B 03            [ 2]  244 	addw	sp, #3
                                    245 ;	./ts.c: 68: setDisplayStr ( (char*) stringBuffer);
      0000AE AEr00r00         [ 2]  246 	ldw	x, #(_main_stringBuffer_65536_13 + 0)
      0000B1 89               [ 2]  247 	pushw	x
      0000B2 CDr00r00         [ 4]  248 	call	_setDisplayStr
      0000B5 5B 02            [ 2]  249 	addw	sp, #2
      0000B7 20 65            [ 2]  250 	jra	00121$
      0000B9                        251 00117$:
                                    252 ;	./ts.c: 69: } else if (getMenuDisplay() == MENU_SELECT_PARAM) {
      0000B9 CDr00r00         [ 4]  253 	call	_getMenuDisplay
      0000BC A1 02            [ 1]  254 	cp	a, #0x02
      0000BE 26 14            [ 1]  255 	jrne	00114$
                                    256 ;	./ts.c: 70: paramMsg[1] = '0' + getParamId();
      0000C0 CDr00r00         [ 4]  257 	call	_getParamId
      0000C3 AB 30            [ 1]  258 	add	a, #0x30
      0000C5 1E 06            [ 2]  259 	ldw	x, (0x06, sp)
      0000C7 F7               [ 1]  260 	ld	(x), a
                                    261 ;	./ts.c: 71: setDisplayStr ( (unsigned char*) &paramMsg);
      0000C8 96               [ 1]  262 	ldw	x, sp
      0000C9 1C 00 03         [ 2]  263 	addw	x, #3
      0000CC 89               [ 2]  264 	pushw	x
      0000CD CDr00r00         [ 4]  265 	call	_setDisplayStr
      0000D0 5B 02            [ 2]  266 	addw	sp, #2
      0000D2 20 4A            [ 2]  267 	jra	00121$
      0000D4                        268 00114$:
                                    269 ;	./ts.c: 72: } else if (getMenuDisplay() == MENU_CHANGE_PARAM) {
      0000D4 CDr00r00         [ 4]  270 	call	_getMenuDisplay
      0000D7 A1 03            [ 1]  271 	cp	a, #0x03
      0000D9 26 26            [ 1]  272 	jrne	00111$
                                    273 ;	./ts.c: 73: paramToString (getParamId(), (char*) stringBuffer);
      0000DB AEr00r00         [ 2]  274 	ldw	x, #(_main_stringBuffer_65536_13 + 0)
      0000DE 1F 01            [ 2]  275 	ldw	(0x01, sp), x
      0000E0 90 93            [ 1]  276 	ldw	y, x
      0000E2 17 09            [ 2]  277 	ldw	(0x09, sp), y
      0000E4 CDr00r00         [ 4]  278 	call	_getParamId
      0000E7 6B 0B            [ 1]  279 	ld	(0x0b, sp), a
      0000E9 1E 09            [ 2]  280 	ldw	x, (0x09, sp)
      0000EB 89               [ 2]  281 	pushw	x
      0000EC 7B 0D            [ 1]  282 	ld	a, (0x0d, sp)
      0000EE 88               [ 1]  283 	push	a
      0000EF CDr00r00         [ 4]  284 	call	_paramToString
      0000F2 5B 03            [ 2]  285 	addw	sp, #3
                                    286 ;	./ts.c: 74: setDisplayStr ( (char *) stringBuffer);
      0000F4 AEr00r00         [ 2]  287 	ldw	x, #(_main_stringBuffer_65536_13 + 0)
      0000F7 1F 0A            [ 2]  288 	ldw	(0x0a, sp), x
      0000F9 89               [ 2]  289 	pushw	x
      0000FA CDr00r00         [ 4]  290 	call	_setDisplayStr
      0000FD 5B 02            [ 2]  291 	addw	sp, #2
      0000FF 20 1D            [ 2]  292 	jra	00121$
      000101                        293 00111$:
                                    294 ;	./ts.c: 76: setDisplayStr ("ERR");
      000101 4Br09            [ 1]  295 	push	#<(___str_3 + 0)
      000103 4Bs00            [ 1]  296 	push	#((___str_3 + 0) >> 8)
      000105 CDr00r00         [ 4]  297 	call	_setDisplayStr
      000108 5B 02            [ 2]  298 	addw	sp, #2
                                    299 ;	./ts.c: 77: setDisplayOff ( (bool) (getUptime() & 0x40) );
      00010A CDr00r00         [ 4]  300 	call	_getUptime
      00010D 1F 0A            [ 2]  301 	ldw	(0x0a, sp), x
      00010F 17 08            [ 2]  302 	ldw	(0x08, sp), y
      000111 7B 0B            [ 1]  303 	ld	a, (0x0b, sp)
      000113 48               [ 1]  304 	sll	a
      000114 48               [ 1]  305 	sll	a
      000115 4F               [ 1]  306 	clr	a
      000116 49               [ 1]  307 	rlc	a
      000117 6B 0B            [ 1]  308 	ld	(0x0b, sp), a
      000119 88               [ 1]  309 	push	a
      00011A CDr00r00         [ 4]  310 	call	_setDisplayOff
      00011D 84               [ 1]  311 	pop	a
      00011E                        312 00121$:
                                    313 ;	./ts.c: 80: WAIT_FOR_INTERRUPT
      00011E 8F               [10]  314 	wfi	
                                    315 ;	./ts.c: 82: }
      00011F CCr00r2A         [ 2]  316 	jp	00123$
                                    317 	.area CODE
                                    318 	.area CONST
                                    319 	.area CONST
      000000                        320 ___str_0:
      000000 00                     321 	.db 0x00
                                    322 	.area CODE
                                    323 	.area CONST
      000001                        324 ___str_1:
      000001 4C 4C 4C               325 	.ascii "LLL"
      000004 00                     326 	.db 0x00
                                    327 	.area CODE
                                    328 	.area CONST
      000005                        329 ___str_2:
      000005 48 48 48               330 	.ascii "HHH"
      000008 00                     331 	.db 0x00
                                    332 	.area CODE
                                    333 	.area CONST
      000009                        334 ___str_3:
      000009 45 52 52               335 	.ascii "ERR"
      00000C 00                     336 	.db 0x00
                                    337 	.area CODE
                                    338 	.area INITIALIZER
                                    339 	.area CABS (ABS)
